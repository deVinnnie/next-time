/*! presenter 2015-06-22 */
var Presenter=Presenter||{};!function(a){"use strict";function b(){}b.actions=new Array,b.init=function(){var a=postal.channel("slides");a.subscribe("navigator",b.handle),a.subscribe("navigatorn",b.handle)},b.handle=function(a){var c=a.action;console.log("[Navigator] Handling "+c),b.actions[c]()},b.register=function(a,c){console.log("[Navigator] "+a+" registered."),b.actions[a]=c},b.registerMap=function(a){for(var c=0;c<a.length;c++){var d=a[c].key,e=a[c].action;b.actions[d]=e,console.log("[Navigator] "+d+" registered.")}},a.Presenter.Navigator=b}(window);var Presenter=Presenter||{};!function(a){"use strict";function b(a){this.deck=a}b.prototype.flush=function(){$("#ticks li").remove()},b.prototype.renew=function(){var a,b=this.deck.getCurrentSlide().querySelectorAll(".step").length,c=document.getElementById("ticks").childNodes.length,d=Math.abs(b-c);if(b>c)a=this.increase;else{if(!(c>b))return;a=this.decrease}for(var e=0;d>e;e++)a.apply(this)},b.prototype.set=function(a){this.flush();for(var b=0;a>b;b++)this.increase()},b.prototype.decrease=function(){var a=$("#ticks li").not(".hidden").last();a.addClass("hidden"),a.hide("fast",function(){a.remove()})},b.prototype.increase=function(){$("#ticks").append($("<li />").append($("<span />").attr("class","tick")))},a.Ticker=b}(Presenter);var Presenter=Presenter||{};!function(a){"use strict";function b(a){this.deck=a,this.groups=[],this.current=-1;var b=postal.channel("slides");b.subscribe("slide-changed",this.reset).withContext(this)}b.prototype.setData=function(){this.deck.getCurrentSlide().dataset.currentGroup=this.current<0||this.current>=this.groups.length?null:this.groups[this.current].name},b.prototype.nextStep=function(){this.current>=0&&this.current<this.groups.length&&$(this.groups[this.current].steps).removeClass("current-step"),this.current<this.groups.length-1&&(this.current++,this.deck.ticker.decrease(),$(this.groups[this.current].steps).removeClass("step"),$(this.groups[this.current].steps).addClass("current-step"),$(this.groups[this.current].steps).addClass("step-done")),this.setData()},b.prototype.previousStep=function(){this.current>=0&&this.current<this.groups.length&&($(this.groups[this.current].steps).removeClass("current-step"),$(this.groups[this.current].steps).removeClass("step-done"),$(this.groups[this.current].steps).addClass("step"),this.current--,this.deck.ticker.increase(),this.current>=0&&$(this.groups[this.current].steps).addClass("current-step")),this.setData()},b.prototype.reset=function(){var a=this.deck.getCurrentSlide().querySelectorAll(".step, .step-done");this.groups=[],this.current=-1;for(var b=0;b<a.length;b++){var c,d=a[b],e=d.dataset.stepGroup;if("undefined"!=typeof e){for(var f=!1,g=0;!f&&g<this.groups.length;)if(this.groups[g].name==e){var h=this.groups[g];h.steps.push(d),c=g,f=!0}else g++;if(!f){var h={};h.name=e,h.steps=[],h.steps[0]=d,this.groups.push(h),c=this.groups.length-1}}else{var h={};h.name=null,h.steps=[],h.steps[0]=d,this.groups.push(h),c=this.groups.length-1}$(d).hasClass("current-step")&&(this.current=c)}this.deck.ticker.set(this.groups.length-(this.current+1)),this.setData()},a.StepManager=b}(Presenter);var Presenter=Presenter||{};!function(a){"use strict";function b(b,c){this.slides=b,this.nSlides=this.slides.length,this.currentSlide=c,this.pointer=!1,this.ticker=new a.Presenter.Ticker(this),this.stepManager=new a.Presenter.StepManager(this),this.initProgressBar(),this.initVideos(),this.channel=postal.channel("slides"),this.channel.subscribe("pre-slide-changed",this.autoStopVideo).withContext(this),this.channel.subscribe("enter-overview",this.autoStopVideo).withContext(this),this.channel.subscribe("slide-changed",this.updateLocationHash).withContext(this),this.channel.subscribe("slide-changed",this.updateProgressBar).withContext(this),this.channel.subscribe("slide-changed",this.refreshNotes).withContext(this),this.channel.subscribe("slide-changed",this.autoPlayVideo).withContext(this),this.channel.subscribe("slide-changed",this.SlideInit).withContext(this),this.channel.subscribe("pre-slide-changed",this.SlideDestroy).withContext(this)}function c(a){var b=a.target;b.paused?b.play():b.pause()}b.SLIDE_STATES=["farPastSlide","pastSlide","currentSlide","futureSlide","farFutureSlide"],b.prototype.updateLocationHash=function(){a.location.hash="#"+this.currentSlide},b.prototype.updateProgressBar=function(){var a=this.currentSlide/this.nSlides*100;progressJs().set(a)},b.prototype.initProgressBar=function(){progressJs().start()},b.prototype.getSlide=function(a){return this.slides[a-1]},b.prototype.getCurrentSlide=function(){return this.getSlide(this.currentSlide)},b.prototype.getSlideNmb=function(a){for(var b=!1,c=0;c<this.slides.length&&b===!1;)this.slides[c]===a?b=!0:c++;return c+1},b.prototype.next=function(){var a=this.getCurrentSlide().querySelectorAll(".step").length;0!=a?(this.stepManager.nextStep(),this.channel.publish("step-changed",{type:"next"})):this.currentSlide+1<=this.nSlides&&(this.channel.publish("pre-slide-changed"),this.nextSlide(),this.channel.publish("slide-changed",{type:"next",slide:this.currentSlide}))},b.prototype.previous=function(){var a=this.getCurrentSlide().querySelectorAll(".step-done").length;a>=1?(this.stepManager.previousStep(),this.channel.publish("step-changed",{type:"previous"})):(this.channel.publish("pre-slide-changed"),this.previousSlide(),this.channel.publish("slide-changed",{type:"previous",slide:this.currentSlide}))},b.prototype.gotoById=function(a){this.channel.publish("pre-slide-changed");for(var b=this.currentSlide-2,c=0;c<this.SLIDE_STATES.length;c++,b++)this.clear(b);var d=this.getSlideNmb(document.getElementById(a));this.currentSlide=d,d-=2;for(var c=0;c<this.SLIDE_STATES.length;c++,d++)this.updateSlide(d,this.SLIDE_STATES[c]);this.channel.publish("slide-changed",{type:"goto",slide:this.currentSlide})},b.prototype.gotoByNumber=function(a){this.currentSlide=a;for(var b=0,c=this.currentSlide-2;c<=this.currentSlide+2;c++,b++)this.updateSlide(c,Presenter.SlideDeck.SLIDE_STATES[b]);this.channel.publish("slide-changed",{type:"goto",slide:this.currentSlide})},b.prototype.nextSlide=function(){if(this.currentSlide<this.nSlides){var a=this.currentSlide-2;this.getSlide(a)&&this.clear(a),a++;for(var c=0;c<b.SLIDE_STATES.length;c++,a++)this.updateSlide(a,b.SLIDE_STATES[c]);this.currentSlide++}},b.prototype.previousSlide=function(){if(this.currentSlide>1){for(var a=this.currentSlide-3,c=0;c<b.SLIDE_STATES.length;c++,a++)this.updateSlide(a,b.SLIDE_STATES[c]);this.getSlide(a)&&this.clear(a),a++,this.currentSlide--}},b.prototype.refreshNotes=function(){$("#notes-display").html("");var a=this.getCurrentSlide();if(a.querySelectorAll(".notes")[0]){var b=a.querySelectorAll(".notes")[0];$("#notes-display").html(b.innerHTML)}},b.prototype.autoPlayVideo=function(){var a=this.getCurrentSlide();null!==a.querySelector("video")&&a.querySelector("video").play()},b.prototype.autoStopVideo=function(){var a=this.getCurrentSlide();null!==a.querySelector("video")&&a.querySelector("video").pause()},b.prototype.updateSlide=function(a,c){if(a>0&&a<=this.slides.length){for(var d=this.getSlide(a),e=0;e<b.SLIDE_STATES.length;e++)d.classList.remove(b.SLIDE_STATES[e]);d.classList.add(c)}},b.prototype.clear=function(a){if(a>0&&a<=this.slides.length)for(var c=this.getSlide(a),d=0;d<b.SLIDE_STATES.length;d++)c.classList.remove(b.SLIDE_STATES[d])},b.prototype.togglePointer=function(){this.pointer=!this.pointer,document.body.classList.toggle("cursor-visible")},b.prototype.showPointer=function(){this.pointer=!0,document.body.classList.add("cursor-visible")},b.prototype.hidePointer=function(){this.pointer=!1,document.body.classList.remove("cursor-visible")},b.prototype.initVideos=function(){for(var a=document.getElementsByTagName("video"),b=0;b<a.length;b++)a[b].addEventListener("click",c,!1)},a.Presenter.SlideDeck=b}(window),Presenter.Navigator.registerMap([{key:"next",action:function(){Presenter.deck.next()}},{key:"previous",action:function(){Presenter.deck.previous()}},{key:"toggle_pointer",action:function(){Presenter.deck.togglePointer()}},{key:"pointer.show",action:function(){Presenter.deck.showPointer()}},{key:"pointer.hide",action:function(){Presenter.deck.hidePointer()}},{key:"toggle_notes",action:function(){$("#notes-display").toggleClass("visible")}},{key:"hide_notes",action:function(){$("#notes-display").removeClass("visible")}},{key:"show_notes",action:function(){$("#notes-display").addClass("visible")}}]);var Presenter=Presenter||{};!function(a){"use strict";function b(){this.enable()}b.map={13:"next",39:"next",34:"next",32:"next",33:"previous",37:"previous",79:"overview",80:"toggle_pointer",87:"curtain.toggle.white",66:"curtain.toggle.black",78:"toggle_notes",77:"sync.master",76:"sync.listen"},b.prototype.enable=function(){$(document).on("keydown",this.handle)},b.prototype.disable=function(){$(document).off("keydown",this.handle)},b.prototype.handle=function(a){var c=postal.channel("slides"),d=a.keyCode;b.map.hasOwnProperty(d)?(a.preventDefault(),console.log(b.map[d]),c.publish("navigator",{action:b.map[d]})):console.info("[Keyboard] Keycode '"+d+"' has no action attached.")},a.Presenter.Keyboard=b}(window);var Presenter=Presenter||{};!function(a){"use strict";function b(){this.enable()}b.prototype.enable=function(){console.log("[Mouse] Enabled"),window.addEventListener&&(document.querySelector(".slideDeck").addEventListener("mousewheel",function(a){b.scrollHandler(a.wheelDelta)},!1),document.querySelector(".slideDeck").addEventListener("DOMMouseScroll",function(a){b.scrollHandler(-a.detail)},!1))},b.scrollHandler=function(b){var c="";c=0>b?"next":"previous",a.postal.channel("slides").publish("navigator",{action:c})},b.prototype.disable=function(){console.log("[Mouse] Disabled"),document.querySelector(".slideDeck").removeEventListener("mousewheel",b.scrollHandler),document.querySelector(".slideDeck").removeEventListener("DOMMouseScroll",b.scrollHandler)},a.Presenter.Mouse=b}(window);var Presenter=Presenter||{};!function(a,b){"use strict";function c(a){if(Presenter.settings=a,"undefined"==typeof c){var c={};c.log=c.error=c.info=c.debug=function(){}}$(b).on("resize",Presenter.onWindowResized),"undefined"!=typeof Hammer&&Presenter.Touch.enable(),Presenter.keyboard=new Presenter.Keyboard,Presenter.mouse=new Presenter.Mouse,d(),e(),Presenter.onWindowResized(),"undefined"!=typeof Presenter.Overview&&(Presenter.overview=new Presenter.Overview(f)),Presenter.Navigator.init(),b.postal.channel("slides").publish("slide-changed")}function d(){$("body").append($("<div/>").attr("id","curtain")).append($("<div/>").attr("id","notes-display")).append($("<div/>").attr("id","ticker").attr("class",Presenter.settings["ticker-position"]).append($("<ul/>").attr("id","ticks"))),$(".slideDeck > section").addClass("slide")}function e(){var a;if(""===location.hash)location.hash="#1",a=1;else{var b=location.hash.substring(1);a=parseInt(b)}f=Presenter.deck=new Presenter.SlideDeck(document.querySelectorAll(".slide"),a);var c=document.defaultView.getComputedStyle(f.slides[0],"");f.slideWidth=parseInt(c.getPropertyValue("width")),f.slideHeight=parseInt(c.getPropertyValue("height"));for(var d=f.currentSlide-2,e=0;e<Presenter.SlideDeck.SLIDE_STATES.length;e++,d++){d>0&&d<=f.nSlides&&f.getSlide(d).classList.add(Presenter.SlideDeck.SLIDE_STATES[e]),$("body").append($("<div/>").attr("class",Presenter.SlideDeck.SLIDE_STATES[e]).attr("id","test"));var g;g="none"!=$("#test").css("transform")?$("#test").css("transform"):"",h[Presenter.SlideDeck.SLIDE_STATES[e]]=g,$("#test").remove()}}var f,g=Presenter.PREFIX=["-webkit-","-moz-","-o-","-ms-",""],h={};Presenter.onWindowResized=function(){var a="@media screen{\n",c=Math.min(b.innerHeight/f.slideHeight,b.innerWidth/f.slideWidth);Presenter.settings.hasOwnProperty("scale")&&(c*=Presenter.settings.scale);var d=Math.round((b.innerWidth-f.slideWidth*c)/2),e=Math.round((b.innerHeight-f.slideHeight*c)/2);c=Math.round(1e3*c)/1e3;for(var i=0;i<Presenter.SlideDeck.SLIDE_STATES.length;i++){a+="."+Presenter.SlideDeck.SLIDE_STATES[i]+"{\n";for(var j=0;j<g.length;j++)a+=g[j]+"transform: scale3d("+c+","+c+",1) ",a+=h[Presenter.SlideDeck.SLIDE_STATES[i]]+";\n";a+="left:"+d+"px;\n",a+="top: "+e+"px;\n",a+="}\n"}a+="\n",$("#style").html(a)},Presenter.disableTransitions=function(){for(var a="",b=0;b<Presenter.SlideDeck.SLIDE_STATES.length;b++){a+="."+Presenter.SlideDeck.SLIDE_STATES[b]+"{\n";for(var c=0;c<g.length;c++)a+=g[c]+"transform: none;\n",a+=g[c]+"transition: all 0s;\n";a+="}\n"}$("#style").html(a)},b.Presenter.init=c}(Presenter,window);var Presenter=Presenter||{};!function(a){"use strict";function b(){}b.active=!1,b.toggle=function(a){b.active===!1?($("#curtain").addClass("closed"),$("#curtain").css("background",a)):$("#curtain").removeClass("closed"),b.active=!b.active},a.Presenter.Curtain=b}(window),Presenter.Navigator.register("curtain.toggle.white",function(){Presenter.Curtain.toggle("#FFF")}),Presenter.Navigator.register("curtain.toggle.black",function(){Presenter.Curtain.toggle("#000")});var Presenter=Presenter||{};!function(a){"use strict";function b(){}b.enable=function(){var a=postal.channel("slides"),b=new Hammer($(".slideDeck")[0]);b.on("swipeleft",function(){a.publish("navigator",{action:"next"})}),b.on("swiperight",function(){a.publish("navigator",{action:"previous"})}),b.on("swipeup",function(){a.publish("navigator",{action:"show_notes"})}),b.on("swipedown",function(){a.publish("navigator",{action:"hide_notes"})}),b.on("press",function(){a.publish("navigator",{action:"overview"})})},a.Presenter.Touch=b}(window);var Presenter=Presenter||{};!function(a){"use strict";function b(a){this.active=!1,this.deck=a}b.prototype.toggle=function(){this.active?this.hide():this.show()};var c=Presenter.PREFIX;b.prototype.show=function(){this.active=!0;var a=this.deck,b=Presenter.settings,d=window.postal.channel("slides");Presenter.mouse.disable(),d.publish("enter-overview"),d.publish("navigator",{action:"pointer.show"});var e=a.slideHeight/a.slideWidth*b.thumbnail_width,f=b.thumbnail_width/a.slideWidth;Presenter.disableTransitions(),$(a.slides).wrap('<div class="slide-wrapper"/>');for(var g=".slide-wrapper{width:"+b.thumbnail_width+"px;height:"+e+"px;}\n.slideDeck.overview .slide-wrapper .slide{\n",h=0;h<c.length;h++)g+=c[h]+"transform: scale("+f+");\n";g+="}",$("#style").append(g),$(window).off("resize"),$(".slideDeck").addClass("overview").on("click",".slide",$.proxy(this.onSelectSlide,this));var i=a.getCurrentSlide();i.parentNode.classList.add("current");for(var h=a.currentSlide-2;h<=a.currentSlide+2;h++)a.clear(h);i.scrollIntoView()},b.prototype.hide=function(){this.active=!1;var a=this.deck,b=(Presenter.settings,window.postal.channel("slides"));Presenter.mouse.enable(),b.publish("navigator",{action:"pointer.hide"}),$(".slideDeck").removeClass("overview").off("click",".slide",this.onSelectSlide),$(".slideDeck > .slide-wrapper.current").removeClass("current"),$(a.slides).unwrap();for(var c=0,d=a.currentSlide-2;d<=a.currentSlide+2;d++,c++)a.updateSlide(d,Presenter.SlideDeck.SLIDE_STATES[c]);$(window).on("resize",Presenter.onWindowResized),$(window).trigger("resize"),b.publish("slide-changed")},b.prototype.onSelectSlide=function(a){var b=a.currentTarget;this.deck.gotoByNumber(this.deck.getSlideNmb(b)),this.hide()},a.Presenter.Overview=b}(window),Presenter.Navigator.register("overview",function(){Presenter.overview.toggle()});var Presenter=Presenter||{};!function(a){"use strict";function b(){}b.master=function(){var a=prompt("URL","");try{var b=new WebSocket("ws://"+a)}catch(c){return alert("WebSocket Error "+c),void console.log("WebSocket Error "+c)}$("body").addClass("master"),$("#ticker").hide(),b.onerror=function(a){alert("WebSocket Error "+a),console.log("WebSocket Error "+a)},b.onmessage=function(a){window.postal.channel("slides").publish("navigatorn",{action:a.data}),console.error("[SyncClient] Server: "+a.data)},window.postal.channel("slides").subscribe("navigator",function(a){b.send(a.action)}).withContext(this)},b.listen=function(){var a=prompt("URL","");try{var b=new WebSocket("ws://"+a)}catch(c){return alert("WebSocket Error "+c),void console.error("[SyncClient] WebSocket Error "+c)}$("#ticker").hide(),b.onerror=function(a){alert("WebSocket Error "+a),console.error("[SyncClient] WebSocket Error "+a)},window.postal.channel("slides").subscribe("navigator",function(a){b.send(a.action)}).withContext(this),b.onmessage=function(a){window.postal.channel("slides").publish("navigatorn",{action:a.data}),console.error("[SyncClient] Server: "+a.data)}},a.Presenter.SyncClient=b}(window),Presenter.Navigator.register("sync.master",function(){Presenter.SyncClient.master()}),Presenter.Navigator.register("sync.listen",function(){Presenter.SyncClient.listen()});